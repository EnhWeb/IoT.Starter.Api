# API

Faster build and availability of Visual Studio development environment are the key advantages of this workflow.



## ASP.NET Core Web API for Raspberry Pi

Starting from a Swagger API definition, an ASP.NET Core  Web API is automatically generated by Swagger Hub. The code is pushed to github and then loaded by a Windows x64 machine and upgraded to ASP.NET Core 2.0, using Visual Studio 2017. 

A multi-stage docker image build is accomplished at the speedy Windows x64 machine, generating code of linux-arm framework. The image container is pushed to the cloud and then pulled back into a Raspberry Pi with Raspbian 9.1 stretch installed.


#### Model:

- Restlet generates API and exports swagger.json  
- Swagger Hub imports file and generates server stub  

#### x64 machine:

- Install Docker
- Pull server stub from github
- Upgrade to .NET Core 2 and Docker support
- Create multi-stage image build for server stub    
- Compiles at x64 machine for linux-arm framework  
- Push Docker image to cloud  

#### Raspberry Pi (hostname "rpi")

- Raspbian GNU/Linux 9.1 (stretch) 
- Install Docker  
- Run Docker image 

#### Tests
 
- Go back to x64 machine
- Access rpi-server-stub via browser  
- http://rpi:5000/swagger/ui/index.html 

## aspnetcore

Testing API at port:5000

**Links:**  
https://app.swaggerhub.com/apis/josemottalopes/contacts-api/1.2.0  
https://github.com/josemotta/Api  
https://hub.docker.com/r/josemottalopes/io.swagger/ 

#### x64: Build 

	cd /aspnetcore
	docker-compose -f docker-compose.ci.build.yml build   
	docker push josemottalopes/io.swagger:latest  

#### arm: RaspberryPi (hostname "rpi")  
`docker run --privileged -p 5000:5000 -d josemottalopes/io.swagger`  

#### any browser: Client Test
    http://rpi:5000/swagger/ui/index.html

## home-web

Starter for Home project at port:5010

**Links:**  
https://app.swaggerhub.com/apis/josemottalopes/home-api/1.0.1  
https://github.com/josemotta/Api  
https://hub.docker.com/r/josemottalopes/home-web/

#### x64: Build 

	cd /home-web
	docker-compose -f docker-compose.ci.build.yml build   
	docker push josemottalopes/home-web:latest  

#### arm: RaspberryPi (hostname "rpi")  
`docker run --privileged -p 5010:5010 -d josemottalopes/home-web`  

#### any browser: Client Test
    http://rpi:5010/swagger/ui/index.html

## Both projects running at RPI

	pi@lumi:~ $ docker images
	REPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE
	josemottalopes/home-web               latest              75e89c7c1cf5        18 minutes ago      235MB
	josemottalopes/io.swagger             latest              fb9745c521f5        3 weeks ago         235MB
	josemottalopes/gpio                   latest              f682dce817fc        5 weeks ago         231MB
	josemottalopes/gpio-base-web          latest              774213c100a5        5 weeks ago         166MB
	josemottalopes/dotnetapp-prod-arm32   v1                  eff107bb8521        2 months ago        165MB

	pi@lumi:~ $ docker ps
	CONTAINER ID        IMAGE                              COMMAND                  CREATED             STATUS              PORTS                    NAMES
	e5fa0180732e        josemottalopes/home-web:latest     "/bin/sh -c /app/I..."   3 minutes ago       Up 3 minutes        0.0.0.0:5010->5010/tcp   elastic_pare
	51cae8e56122        josemottalopes/io.swagger:latest   "/bin/sh -c /app/I..."   32 minutes ago      Up 32 minutes       0.0.0.0:5000->5000/tcp   confident_ramanujan